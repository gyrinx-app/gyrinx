{% extends "core/layouts/base.html" %}
{% load allauth custom_tags %}
{% block head_title %}
    {{ title }} - {{ list.name }}
{% endblock head_title %}
{% block content %}
    {% include "core/includes/list_common_header.html" with list=list link_list="true" %}
    <div class="col-12 col-md-8 col-lg-6 px-0 vstack gap-3">
        <h1 class="h3">{{ title }}</h1>
        <form method="post" class="vstack gap-4">
            {% csrf_token %}
            {% if form.non_field_errors %}
                <div class="alert alert-danger">
                    {% for error in form.non_field_errors %}<p class="mb-0">{{ error }}</p>{% endfor %}
                </div>
            {% endif %}
            <!-- Template Name -->
            <div>
                <label for="{{ form.name.id_for_label }}" class="form-label">{{ form.name.label }}</label>
                {{ form.name.errors }}
                {{ form.name }}
                <small class="form-text text-muted">{{ form.name.help_text }}</small>
            </div>
            <!-- Fighter Selection Section -->
            <div>
                <h2 class="h5 mb-3">Chosen Fighters</h2>
                <p class="text-muted small mb-3">{{ form.chosen_fighters.help_text }}</p>
                <div class="border rounded p-3 overflow-auto">
                    {% if form.chosen_fighters.field.queryset.exists %}
                        <div class="vstack gap-2" id="fighter-checkboxes">
                            {% for choice in form.chosen_fighters %}{{ choice }}{% endfor %}
                        </div>
                    {% else %}
                        <p class="text-muted mb-0">No active fighters available.</p>
                    {% endif %}
                </div>
            </div>
            <!-- Random Count Section -->
            <div>
                <h2 class="h5 mb-3">Random Selection</h2>
                <p class="text-muted small mb-3">{{ form.random_count.help_text }}</p>
                <div>
                    <label for="{{ form.random_count.id_for_label }}" class="form-label">{{ form.random_count.label }}</label>
                    {{ form.random_count.errors }}
                    {{ form.random_count }}
                </div>
            </div>
            <!-- Form Actions -->
            <div class="mt-3">
                <button type="submit" class="btn btn-primary">
                    {% if crew_template %}
                        Update
                    {% else %}
                        Create
                    {% endif %}
                    Template
                </button>
                {% url 'core:crew-template-index' list.id as cancel_url %}
                {% include "core/includes/cancel.html" with url=cancel_url %}
            </div>
        </form>
    </div>
{% endblock content %}
