{% extends "core/layouts/base.html" %}
{% load allauth custom_tags color_tags %}
{% comment %}
    Captured Fighters screen for a campaign.
    Displays all captured fighters with links to their original gang and capturing gang.
{% endcomment %}
{% block head_title %}
    Captured Fighters - {{ campaign.name }}
{% endblock head_title %}
{% block content %}
    {% include "core/includes/back.html" with url=campaign.get_absolute_url text="Back to Campaign" %}
    <div class="col-lg-12 px-0 vstack gap-3">
        <div class="vstack gap-0 mb-2">
            <div class="hstack gap-2 mb-2 align-items-start align-items-md-center">
                <div class="d-flex flex-column flex-md-row flex-grow-1 align-items-start align-items-md-center gap-2">
                    <h1 class="mb-0">Captured Fighters</h1>
                </div>
            </div>
            <div class="text-secondary">{{ campaign.name }}</div>
        </div>
        {% if captured_fighters %}
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Fighter</th>
                            <th>Original Gang</th>
                            <th>Captured By</th>
                            <th>Status</th>
                            <th>Captured Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for captured in captured_fighters %}
                            <tr>
                                <td>
                                    <a href="{% url 'core:list' captured.fighter.list.id %}#{{ captured.fighter.id }}"
                                       class="link-underline-opacity-25 link-underline-opacity-100-hover">
                                        <strong>{{ captured.fighter.name }}</strong>
                                    </a>
                                    <br>
                                    <small class="text-secondary">{{ captured.fighter.content_fighter.type }}</small>
                                </td>
                                <td>
                                    <a href="{% url 'core:list' captured.fighter.list.id %}"
                                       class="link-underline-opacity-25 link-underline-opacity-100-hover">{% list_with_theme captured.fighter.list %}</a>
                                </td>
                                <td>
                                    <a href="{% url 'core:list' captured.capturing_list.id %}"
                                       class="link-underline-opacity-25 link-underline-opacity-100-hover">{% list_with_theme captured.capturing_list %}</a>
                                </td>
                                <td>
                                    {% if captured.sold_to_guilders %}
                                        <span class="badge bg-secondary">Sold to Guilders</span>
                                        {% if captured.ransom_amount %}
                                            <br>
                                            <small>{{ captured.ransom_amount }}¢</small>
                                        {% endif %}
                                    {% else %}
                                        <span class="badge bg-warning text-dark">Captured</span>
                                    {% endif %}
                                </td>
                                <td>{{ captured.captured_at|date:"M d, Y" }}</td>
                                <td>
                                    {% if not captured.sold_to_guilders %}
                                        {% if captured.capturing_list.owner == request.user or campaign.owner == request.user %}
                                            <div class="btn-group btn-group-sm" role="group">
                                                <a href="{% url 'core:fighter-sell-to-guilders' campaign.id captured.fighter.id %}"
                                                   class="btn btn-outline-secondary">Sell to Guilders</a>
                                                <a href="{% url 'core:fighter-return-to-owner' campaign.id captured.fighter.id %}"
                                                   class="btn btn-outline-secondary">Return to Owner</a>
                                                <a href="{% url 'core:fighter-release' campaign.id captured.fighter.id %}"
                                                   class="btn btn-outline-secondary">Release</a>
                                            </div>
                                        {% elif captured.fighter.list.owner == request.user %}
                                            <div class="btn-group btn-group-sm" role="group">
                                                <a href="{% url 'core:fighter-return-to-owner' campaign.id captured.fighter.id %}"
                                                   class="btn btn-outline-secondary">Return to Owner</a>
                                                <a href="{% url 'core:fighter-release' campaign.id captured.fighter.id %}"
                                                   class="btn btn-outline-secondary">Release</a>
                                            </div>
                                        {% else %}
                                            <span class="text-secondary">Not your captive</span>
                                        {% endif %}
                                    {% else %}
                                        <span class="text-secondary">—</span>
                                    {% endif %}
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <div class="alert alert-info">
                <i class="bi-info-circle"></i> No fighters have been captured in this campaign yet.
            </div>
        {% endif %}
    </div>
{% endblock content %}
